{
  "schemaVersion": "2.2",
  "description": "Deploys personal website from GitHub onto an EC2 instance",
  "parameters": {},
  "mainSteps": [
    {
      "action": "aws:runShellScript",
      "name": "DeployWebsite",
      "inputs": {
        "runCommand": [
          "#!/bin/bash",
          "set -e",
          "echo 'Starting deployment'",
          "mkdir -p /home/ec2-user/app",
          "cd /home/ec2-user/app",
          "sudo git clone https://x-access-token:${GITHUB_TOKEN}@github.com/stevenodu/odurates.git  .",
          "sudo chown -R ec2-user:ec2-user /home/ec2-user/app",
          "sudo systemctl restart nginx"
        ]
      }
    }
  ]
}